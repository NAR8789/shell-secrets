dependencies:
  pre:
    - sudo add-apt-repository ppa:duggan/bats --yes
    - sudo apt-get -qq update
    - sudo apt-get install -y bats
    - npm install -g tap-xunit
checkout:
  post:
    - git submodule sync --recursive
    - git submodule update --init --recursive
test:
  override:
    - bats test | tee "$CIRCLE_TEST_REPORTS/test.tap.txt"
    - cat "$CIRCLE_TEST_REPORTS/test.tap.txt" | tap-xunit > "$CIRCLE_TEST_REPORTS/test.junit.xml"
    - ./test/test_helper/ensure_failures.sh
